<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>KEEHIN REPORT LIST - TREE MODE</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');

            body {
                background-color: #f4f7f6;
                color: #2c3e50;
                font-family: 'Fira Code', monospace;
                margin: 0;
                padding: 30px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            #tree-container {
                width: 95%;
                max-width: 1200px;
                background-color: #ffffff;
                border: 1px solid #dcdde1;
                border-radius: 8px;
                padding: 25px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
                white-space: pre;
                overflow-x: auto;
                font-size: 14px;
                line-height: 1.6;
            }

            .header {
                width: 95%;
                max-width: 1200px;
                margin-bottom: 15px;
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                border-bottom: 2px solid #2c3e50;
                padding-bottom: 10px;
            }

            .path-info {
                color: #34495e;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <span>DIRECTORY STRUCTURE</span>
            <span>DATE / SIZE</span>
        </div>
        <pre id="tree-container">INITIALIZING DIRECTORY SCAN...</pre>

        <script>
            const treeContainer = document.getElementById("tree-container");

            function pad(str, length, char = ' ') {
                str = String(str || "");
                return str.padEnd(length, char);
            }

            function rightJustify(mainText, metadata, totalWidth) {
                const spaces = totalWidth - mainText.length - metadata.length;
                return mainText + (spaces > 0 ? " ".repeat(spaces) : "  ") + metadata;
            }

            async function fetchAndRenderReports() {
                try {
                    const response = await fetch("json");
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                    
                    const data = await response.json();
                    if (!data || data.length === 0) {
                        treeContainer.textContent = "NO REPORTS FOUND.";
                        return;
                    }

                    // Identify the root path if possible (the first entry which is usually the root dir from Files.walk)
                    let rootPath = "";
                    for (let item of data) {
                        if (!item.report && item.file.includes("/")) {
                            rootPath = item.file;
                            break;
                        }
                    }

                    let output = "";
                    const TOTAL_WIDTH = 110;

                    data.forEach((item, index) => {
                        let line = "";
                        let metadata = "";

                        if (item.report) {
                            // It's a file
                            const prefix = index === data.length - 1 ? "â””â”€â”€ " : "â”œâ”€â”€ ";
                            line = prefix + item.file + " (" + item.report + ")";
                            metadata = pad(item.updated, 20) + " " + pad(item.size + "K", 8, ' ');
                        } else {
                            // It's a directory
                            let dirName = item.file;
                            if (rootPath && dirName.startsWith(rootPath)) {
                                dirName = dirName.substring(rootPath.length) || "/";
                            }
                            line = "ðŸ“‚ " + dirName;
                            metadata = "";
                        }

                        output += rightJustify(line, metadata, TOTAL_WIDTH) + "\n";
                    });

                    treeContainer.textContent = output;
                } catch (error) {
                    treeContainer.textContent = "ERROR: FAILED TO LOAD DIRECTORY STRUCTURE\n" + error.message;
                    console.error("Error fetching report data:", error);
                }
            }

            document.addEventListener("DOMContentLoaded", fetchAndRenderReports);
        </script>
    </body>
</html>
