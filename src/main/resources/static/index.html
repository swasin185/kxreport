<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KxReport</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  </head>
  <body bgcolor="black">
    <img src="khlogo-xs.png" alt="logo" />
    <br />
    <div class="center">
      <form
        name="form"
        action="openPDF"
        method="post"
        target="report"
        onsubmit="window.open('about:blank','report','width=1000,height=1000,toolbar=no,menubar=no');"
      >
        <table>
          <tr>
            <td><label for="report">Report</label></td>
            <td><input type="text" name="report" value="00-000" required /></td>
          </tr>
          <tr>
            <td><label for="db">Database</label></td>
            <td><input type="text" name="db" value="kxtest" required /></td>
          </tr>
          <tr>
            <td><label for="comCode">Company Code</label></td>
            <td><input type="number" name="comCode" value="1" /></td>
          </tr>
          <tr>
            <td><label for="comName">Company Name</label></td>
            <td><input type="text" name="comName" value="Company Name" /></td>
          </tr>
          <tr>
            <td><label for="fromDate">From Date</label></td>
            <td><input type="date" name="fromDate" /></td>
          </tr>
          <tr>
            <td><label for="toDate">To Date</label></td>
            <td><input type="date" name="toDate" /></td>
          </tr>
          <tr>
            <td><label for="fromId">From ID</label></td>
            <td><input type="text" name="fromId" value="000000" /></td>
          </tr>
          <tr>
            <td><label for="toId">To ID</label></td>
            <td><input type="text" name="toId" value="999999" /></td>
          </tr>
          <tr>
            <td><label for="option">Option</label></td>
            <td><input type="number" name="option" value="5" /></td>
          </tr>
          <tr>
            <td><label for="idList">ID List</label></td>
            <td><input type="text" name="idList" value="" /></td>
          </tr>
        </table>
        <hr />
        <button type="submit">Call Report</button>
      </form>
      <button onclick="callFilePDF()">Call File Report</button>
    </div>
  </body>

  <script lang="js">
    let today = new Date().toISOString().split('T')[0];
    document.getElementsByName('toDate')[0].value = today;
    document.getElementsByName('fromDate')[0].value = today.substring(0, 4) + '-01-01';

    async function callFilePDF() {
      const url = new URL('filePDF', location.href);
      url.searchParams.append('db','payroll');
      url.searchParams.append('report', '00-000');
      url.searchParams.append('comCode', '1');
      url.searchParams.append('fromDate', document.getElementsByName('fromDate')[0].value);
      url.searchParams.append('toDate', document.getElementsByName('toDate')[0].value);
      url.searchParams.append('option', 0);
      const response = await fetch(url, {
          method: 'POST',
      });
      const result = await response.text();
      window.open("output/"+result, 'report', 'width=1000,height=1000,toolbar=no,menubar=no');
    }
  </script>

  <style>
    .center {
      display: grid;
      justify-content: center;
      align-items: center;
      width: 400px;
      height: 400px;
      border: 1px solid black;
      background-color: lightgrey;
    }
  </style>
</html>
